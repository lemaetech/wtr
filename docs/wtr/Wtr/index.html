<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wtr (wtr.Wtr)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 244b5317d"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">wtr</a> &#x00BB; Wtr</nav><header class="odoc-preamble"><h1>Module <code><span>Wtr</span></code></h1><p>A HTTP request routing library.</p><p><code>Wtr</code> (<i>Well Typed Router</i>) is a HTTP request routing library for OCaml web applications.</p><p>Given a HTTP <a href="#type-request_target"><code>request_target</code></a> and a HTTP <a href="#type-method'"><code>method'</code></a>, <code>wtr</code> attempts to match the two properties to a pre-defined set of <a href="#type-route"><code>route</code></a>s. If a match is found then the corresponding <i>route handler</i> function of the matched route is executed.</p><p>The <i>well typed</i> part in <code>Wtr</code> means that the <i>route handler</i> functions can capture and receive arguments which are typed in a variety of OCaml types.</p><p><code>wtr</code> implements two Request Target DSLs to aid in specifying <i>route</i>s for the <i>router</i>:</p><ul><li><a href="#request_target_dsl">Combinators based</a></li><li>PPX based - provided by opam package <code>wtr-ppx</code></li></ul></header><nav class="odoc-toc"><ul><li><a href="#references">References</a></li><li><a href="#types">Types</a></li><li><a href="#arg_func">Arg</a></li><li><a href="#request_target_dsl">Request Target DSL</a><ul><li><a href="#general-components">General Components</a></li><li><a href="#arg-components">Arg Components</a><ul><li><a href="#path">Path</a></li><li><a href="#query">Query</a></li></ul></li><li><a href="#matching-last-components">Matching Last Components</a></li></ul></li><li><a href="#http-method">HTTP Method</a></li><li><a href="#route-and-router">Route and Router</a></li><li><a href="#pp">Pretty Printers</a></li></ul></nav><div class="odoc-content"><h4 id="references"><a href="#references" class="anchor"></a>References</h4><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc7230#section-5.3">RFC 7230 - HTTP Request Target</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7231#section-4">RFC 7231 - HTTP Methods</a></li></ul><h2 id="types"><a href="#types" class="anchor"></a>Types</h2><div class="odoc-spec"><div class="spec type" id="type-router" class="anchored"><a href="#type-router" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a router</span></span></code></div><div class="spec-doc"><p>A <a href="#type-router"><code>router</code></a> consists of one or many HTTP request <a href="#type-route"><code>route</code></a>s which are used to match a given HTTP request target. The base algorithm used for matching is a radix trie.</p><p><code>'a</code> represents the value returned after executing the corresponding route handler of a matched route.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-route" class="anchored"><a href="#type-route" class="anchor"></a><code><span><span class="keyword">and</span> <span>'a route</span></span></code></div><div class="spec-doc"><p><a href="#type-route"><code>route</code></a> is a HTTP request route. A route encapsulates a HTTP <a href="#type-method'"><code>method'</code></a>, a <a href="#type-request_target"><code>request_target</code></a> and a <i>route handler</i>. A <i>route handler</i> is either of the following:</p><ul><li>a value of type <code>'a</code></li><li>or a function which returns a value of type <code>'a</code>.</li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-request_target" class="anchored"><a href="#type-request_target" class="anchor"></a><code><span><span class="keyword">and</span> <span>('a, 'b) request_target</span></span></code></div><div class="spec-doc"><p><a href="#type-request_target"><code>request_target</code></a> is a HTTP request target value to be matched. It consists of either just a <a href="#type-path"><code>path</code></a> value or a combination of <a href="#type-path"><code>path</code></a> and <a href="#type-query"><code>query</code></a> values.</p><p>Example <i>request_target</i> values:</p><ul><li><code>/home/about/</code> - path only</li><li><code>/home/contact</code> - path only</li><li><code>/home/contact?name=a&amp;no=123</code> - path (<code>/home/contact</code>) and query (<code>name=a&amp;no=123</code>). Path and query are delimited by <code>?</code> character token if both are specified.</li></ul><p>Consult <a href="#request_target_dsl">Request Target DSL</a> for creating values of this type.</p><p>See <a href="https://datatracker.ietf.org/doc/html/rfc7230#section-5.3">HTTP RFC 7230 - request target</a>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-path" class="anchored"><a href="#type-path" class="anchor"></a><code><span><span class="keyword">and</span> <span>('a, 'b) path</span></span></code></div><div class="spec-doc"><p><a href="#type-path"><code>path</code></a> is a part of <a href="#type-request_target"><code>request_target</code></a>. It consists of one or more <b>path component</b>s. <b>path component</b>s are tokens which are delimited by a <code>/</code> character token.</p><p>Example of <i>path</i> and <i>path component</i>s:</p><ul><li><code>/</code> has path a component <code>/</code></li><li><code>/home/about</code> has path components <code>home, about</code></li><li><code>/home/contact/</code> has path components <code>home</code>, <code>contact</code> and <code>/</code></li></ul><p>Consult <a href="#path">path combinators</a> for creating values of this type.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-query" class="anchored"><a href="#type-query" class="anchor"></a><code><span><span class="keyword">and</span> <span>('a, 'b) query</span></span></code></div><div class="spec-doc"><p><a href="#type-query"><code>query</code></a> is a part of <a href="#type-request_target"><code>request_target</code></a>. It consists of one of more <b>query component</b>s which are delimited by a <code>&amp;</code> character token. A <b>query component</b> further consists of a pair of values called <code>name</code> and <code>value</code>. <code>name</code> and <code>value</code> tokens are delimited by a <code>=</code> character token. A <b>query component</b> is represented syntactically as <code>(name,value)</code>.</p><p>Given a <i>request_target</i> <code>/home/about?a=2&amp;b=3</code>, the <b>query component</b>s are <code>(a,2)</code> and <code>(b,3)</code>.</p><p>Consult <a href="#query">query combinators</a> for creating values of this type.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-method'" class="anchored"><a href="#type-method'" class="anchor"></a><code><span><span class="keyword">and</span> method'</span><span> = </span><span>[ </span></code><table><tr id="type-method'.GET" class="anchored"><td class="def constructor"><a href="#type-method'.GET" class="anchor"></a><code><span>| </span></code><code><span>`GET</span></code></td></tr><tr id="type-method'.HEAD" class="anchored"><td class="def constructor"><a href="#type-method'.HEAD" class="anchor"></a><code><span>| </span></code><code><span>`HEAD</span></code></td></tr><tr id="type-method'.POST" class="anchored"><td class="def constructor"><a href="#type-method'.POST" class="anchor"></a><code><span>| </span></code><code><span>`POST</span></code></td></tr><tr id="type-method'.PUT" class="anchored"><td class="def constructor"><a href="#type-method'.PUT" class="anchor"></a><code><span>| </span></code><code><span>`PUT</span></code></td></tr><tr id="type-method'.DELETE" class="anchored"><td class="def constructor"><a href="#type-method'.DELETE" class="anchor"></a><code><span>| </span></code><code><span>`DELETE</span></code></td></tr><tr id="type-method'.CONNECT" class="anchored"><td class="def constructor"><a href="#type-method'.CONNECT" class="anchor"></a><code><span>| </span></code><code><span>`CONNECT</span></code></td></tr><tr id="type-method'.OPTIONS" class="anchored"><td class="def constructor"><a href="#type-method'.OPTIONS" class="anchor"></a><code><span>| </span></code><code><span>`OPTIONS</span></code></td></tr><tr id="type-method'.TRACE" class="anchored"><td class="def constructor"><a href="#type-method'.TRACE" class="anchor"></a><code><span>| </span></code><code><span>`TRACE</span></code></td></tr><tr id="type-method'.Method" class="anchored"><td class="def constructor"><a href="#type-method'.Method" class="anchor"></a><code><span>| </span></code><code><span>`Method <span class="keyword">of</span> string</span></code></td></tr></table><code><span> ]</span></code></div><div class="spec-doc"><p><a href="#type-method'"><code>method'</code></a> is a HTTP request method. See <a href="https://datatracker.ietf.org/doc/html/rfc7231#section-4">HTTP RFC 7231 - HTTP Methods</a></p></div></div><div class="odoc-spec"><div class="spec type" id="type-arg" class="anchored"><a href="#type-arg" class="anchor"></a><code><span><span class="keyword">and</span> <span>'a arg</span></span></code></div><div class="spec-doc"><p><a href="#type-arg"><code>arg</code></a> is a component which can convert a <b>path component</b> or a <b>query component</b> <code>value</code> token into an OCaml typed value represented by <code>'a</code>. The successfully converted value is then fed to a <i>route handler</i> function as an argument.</p></div></div><h2 id="arg_func"><a href="#arg_func" class="anchor"></a>Arg</h2><div class="odoc-spec"><div class="spec value" id="val-arg" class="anchored"><a href="#val-arg" class="anchor"></a><code><span><span class="keyword">val</span> arg : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-arg">arg</a></span></span></code></div><div class="spec-doc"><p><code>arg name convert</code> is <a href="#type-arg"><code>arg</code></a> with a name <code>name</code> and <code>convert</code> as the function which will convert/decode a string value to an OCaml value of type <code>'a</code>.</p><p><code>name</code> is used during the pretty-printing of <i>request_target</i> by <a href="#val-pp_request_target"><code>pp_request_target</code></a>.</p><p><code>convert v</code> is <code>Some a</code> if <code>convert</code> can successfully convert <code>v</code> to <code>a</code>. Otherwise it is <code>None</code>.</p><p>The following defines an arg of type <code>Fruit.t arg</code>.</p><pre><code>module Fruit = struct
  type t = Apple | Orange | Pineapple

  let t : t Wtr.arg =
    Wtr.arg &quot;fruit&quot; (function
      | &quot;apple&quot; -&gt; Some Apple
      | &quot;orange&quot; -&gt; Some Orange
      | &quot;pineapple&quot; -&gt; Some Pineapple
      | _ -&gt; None )
end</code></pre></div></div><h2 id="request_target_dsl"><a href="#request_target_dsl" class="anchor"></a>Request Target DSL</h2><p>Request Target combinators implement a DSL(domain specific language) to specify <a href="#type-request_target"><code>request_target</code></a> values and hence both <b>path component</b> and <b>query component</b> values.</p><p>Let's assume that we want to specify a HTTP route which matches a request target value as such:</p><ol><li>match a string literal &quot;hello&quot; exactly</li><li>followed by a valid OCaml <code>int</code> value</li><li>and then finally followed by an OCaml <code>string</code> value</li></ol><p>We can use path combinators to implement such a requirement:</p><pre><code>let target1 = Wtr.(exact &quot;hello&quot; / int / string /. pend) </code></pre><p>The <code>target1</code> above matches the following instances of HTTP request target:</p><ul><li><code>/home/2/str1</code></li><li><code>/home/3/str2</code></li><li><code>/home/-10/str3</code></li></ul><h3 id="general-components"><a href="#general-components" class="anchor"></a>General Components</h3><div class="odoc-spec"><div class="spec value" id="val-(/)" class="anchored"><a href="#val-(/)" class="anchor"></a><code><span><span class="keyword">val</span> (/) : <span><span>(<span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span></span></code></div><div class="spec-doc"><p><code> p1 / p2</code> is a closure that <i>combines</i> <code>p1</code> and <code>p2</code>. <code>p1</code> and <code>p2</code> are closures which encapsulate <a href="#type-path"><code>path</code></a> value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(/&amp;)" class="anchored"><a href="#val-(/&amp;)" class="anchor"></a><code><span><span class="keyword">val</span> (/&amp;) : <span><span>(<span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span></span></code></div><div class="spec-doc"><p><code>q1 /&amp; q1</code> is a closure that <i>combines</i> <code>q1</code> and <code>q2</code>. <code>q1</code> and <code>q2</code> are closures which encapsulate <a href="#type-query"><code>query</code></a> value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(/?)" class="anchored"><a href="#val-(/?)" class="anchor"></a><code><span><span class="keyword">val</span> (/?) : <span><span>(<span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'d</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span></span></code></div><div class="spec-doc"><p><code> p /? q</code> is a closure which <i>combines</i> <code>p</code> and <code>q</code>. <code>p</code> is a closure which encapsulates <a href="#type-path"><code>path</code></a> value and <code>q</code> is a closure which encapsulate <a href="#type-query"><code>query</code></a> value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(/.)" class="anchored"><a href="#val-(/.)" class="anchor"></a><code><span><span class="keyword">val</span> (/.) : <span><span>(<span><span><span>(<span class="type-var">'d</span>, <span class="type-var">'e</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-path">path</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'d</span>, <span class="type-var">'e</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-request_target">request_target</a></span></span></code></div><div class="spec-doc"><p><code> p /. pe</code> is a <a href="#type-request_target"><code>request_target</code></a> value that consists of only path components. <code>pe</code> is a path value that match the last path component.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(/?.)" class="anchored"><a href="#val-(/?.)" class="anchor"></a><code><span><span class="keyword">val</span> (/?.) : <span><span>(<span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="#type-path">path</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'d</span>)</span> <a href="#type-request_target">request_target</a></span></span></code></div><div class="spec-doc"><p><code> pq /?. ()</code> is a <a href="#type-request_target"><code>request_target</code></a> value. <code>pq</code> is a closure which encapulates both <a href="#type-path"><code>path</code></a> and <a href="#type-query"><code>query</code></a> components.</p><pre><code>let request_target1 =
  Wtr.(
    exact &quot;hello&quot;
    / bool
    /? qint &quot;hello&quot;
    /&amp; qstring &quot;hh&quot;
    /&amp; qbool &quot;b&quot;
    /?. ())</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-exact" class="anchored"><a href="#val-exact" class="anchor"></a><code><span><span class="keyword">val</span> exact : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>exact e p</code> matches a path component to <code>e</code> exactly.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qexact" class="anchored"><a href="#val-qexact" class="anchor"></a><code><span><span class="keyword">val</span> qexact : <span><span>(string * string)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qexact (field, e)</code> matches a query component to <code>e</code> exactly. The query component token <code>name</code> value is <code>field</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_request_target" class="anchored"><a href="#val-to_request_target" class="anchor"></a><code><span><span class="keyword">val</span> to_request_target : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-request_target">request_target</a></span></span></code></div><div class="spec-doc"><p><code>to_request_target p</code> is <a href="#type-request_target"><code>request_target</code></a> consisting of only path <code>p</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-root" class="anchored"><a href="#val-root" class="anchor"></a><code><span><span class="keyword">val</span> root : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-request_target">request_target</a></span></span></code></div><div class="spec-doc"><p><code>root</code> is a <i>request_target</i> with <code>/</code> as the only component, i.e. it matches exactly the root HTTP request.</p></div></div><h3 id="arg-components"><a href="#arg-components" class="anchor"></a>Arg Components</h3><p>Path/Query arg components encapsulate <a href="#type-arg"><code>arg</code></a> value which are then fed to a <i>route handler</i> function as an argument.</p><h4 id="path"><a href="#path" class="anchor"></a>Path</h4><div class="odoc-spec"><div class="spec value" id="val-int" class="anchored"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>int</code> matches valid OCaml <code>int</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int32" class="anchored"><a href="#val-int32" class="anchor"></a><code><span><span class="keyword">val</span> int32 : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int32 <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>int32</code> matches valid OCaml <code>int32</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-int64" class="anchored"><a href="#val-int64" class="anchor"></a><code><span><span class="keyword">val</span> int64 : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int64 <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>int64</code> matches valid OCaml <code>int64</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-float" class="anchored"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>float <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>float</code> matches valid OCaml <code>float</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-bool" class="anchored"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>bool <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>bool</code> matches valid OCaml <code>bool</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>string</code> matches valid OCaml <code>string</code> values.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parg" class="anchored"><a href="#val-parg" class="anchor"></a><code><span><span class="keyword">val</span> parg : <span><span><span class="type-var">'c</span> <a href="#type-arg">arg</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>parg d p</code> matches a path component if arg <code>d</code> can successfully convert path component to a value of type <code>'c</code>.</p></div></div><h4 id="query"><a href="#query" class="anchor"></a>Query</h4><div class="odoc-spec"><div class="spec value" id="val-qint" class="anchored"><a href="#val-qint" class="anchor"></a><code><span><span class="keyword">val</span> qint : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qint field</code> matches a valid OCaml <code>int</code> value. <code>field</code> is the <code>name</code> token of <i>query component</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qint32" class="anchored"><a href="#val-qint32" class="anchor"></a><code><span><span class="keyword">val</span> qint32 : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int32 <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qint32 field</code> matches a valid OCaml <code>int32</code> value. <code>field</code> is the <code>name</code> token of <i>query component</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qint64" class="anchored"><a href="#val-qint64" class="anchor"></a><code><span><span class="keyword">val</span> qint64 : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>int64 <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qint64 field</code> matches a valid OCaml <code>int64</code> value. <code>field</code> is the <code>name</code> token of <i>query component</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qfloat" class="anchored"><a href="#val-qfloat" class="anchor"></a><code><span><span class="keyword">val</span> qfloat : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>float <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qfloat field</code> matches a valid OCaml <code>float</code> value. <code>field</code> is the <code>name</code> token of <i>query component</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qbool" class="anchored"><a href="#val-qbool" class="anchor"></a><code><span><span class="keyword">val</span> qbool : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>bool <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qbool field</code> matches a valid OCaml <code>bool</code> value. <code>field</code> is the <code>name</code> token of <i>query component</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qstring" class="anchored"><a href="#val-qstring" class="anchor"></a><code><span><span class="keyword">val</span> qstring : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qstring field</code> matches a valid OCaml <code>string</code> value. <code>field</code> is the <code>name</code> token of <i>query component</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-qarg" class="anchored"><a href="#val-qarg" class="anchor"></a><code><span><span class="keyword">val</span> qarg : <span><span>(string * <span><span class="type-var">'c</span> <a href="#type-arg">arg</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'c</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-query">query</a></span></span></code></div><div class="spec-doc"><p><code>qarg (field, d)</code> matches a query component if <i>arg</i> <code>d</code> can successfully convert path component to a value of type <code>'c</code>.</p></div></div><h3 id="matching-last-components"><a href="#matching-last-components" class="anchor"></a>Matching Last Components</h3><p>These combinators match the last(end) path component. They are used with <a href="#val-(/.)"><code>(/.)</code></a> function.</p><div class="odoc-spec"><div class="spec value" id="val-pend" class="anchored"><a href="#val-pend" class="anchor"></a><code><span><span class="keyword">val</span> pend : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>pend</code> matches the end of <a href="#type-path"><code>path</code></a> value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-splat" class="anchored"><a href="#val-splat" class="anchor"></a><code><span><span class="keyword">val</span> splat : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>splat</code> matches and captures all of the remaining path and query components. The captured value is then fed to a <i>route handler</i>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-slash" class="anchored"><a href="#val-slash" class="anchor"></a><code><span><span class="keyword">val</span> slash : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-path">path</a></span></span></code></div><div class="spec-doc"><p><code>slash</code> matches path component <code>/</code> first and then matches the end of the <a href="#type-path"><code>path</code></a> value.</p></div></div><h2 id="http-method"><a href="#http-method" class="anchor"></a>HTTP Method</h2><div class="odoc-spec"><div class="spec value" id="val-method_equal" class="anchored"><a href="#val-method_equal" class="anchor"></a><code><span><span class="keyword">val</span> method_equal : <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>method_equal m1 m2</code> is <code>true</code> if <code>m1</code> and <code>m2</code> is the same value. Otherwise it is <code>false</code>.</p><p><i>Note</i> if both <code>m1</code> and <code>m2</code> are <code>`Method m</code> then the string comparison is case insensitive.</p><pre><code>Wtr.method_equal `GET `GET = true;;
Wtr.method_equal `POST `GET = false;;
Wtr.method_equal (`Method &quot;meth&quot;) (`Method &quot;METH&quot;) = true</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-method'" class="anchored"><a href="#val-method'" class="anchor"></a><code><span><span class="keyword">val</span> method' : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-method'">method'</a></span></code></div><div class="spec-doc"><p><code>method' m</code> is <a href="#type-method'"><code>method'</code></a> where string value <code>m</code> is converted to <a href="#type-method'"><code>method'</code></a> as follows:</p><ul><li><code>&quot;GET&quot;</code> to <code>`GET</code></li><li><code>&quot;HEAD&quot;</code> to <code>`HEAD</code></li><li><code>&quot;POST&quot;</code> to <code>`POST</code></li><li><code>&quot;PUT&quot;</code> to <code>`PUT</code></li><li><code>&quot;DELETE&quot;</code> to <code>`DELETE</code></li><li><code>&quot;CONNECT&quot;</code> to <code>`CONNECT</code></li><li><code>&quot;OPTIONS&quot;</code> to <code>`OPTIONS</code></li><li><code>&quot;TRACE&quot;</code> to <code>`TRACE</code></li><li>Any other value <code>m</code> to <code>`Method m</code></li></ul><p><i>Note</i> String comparison is case insensitive.</p><pre><code>Wtr.method' &quot;GET&quot; = `GET;;
Wtr.method' &quot;get&quot; = `GET;;
Wtr.method' &quot;method&quot; = `Method &quot;method&quot;</code></pre></div></div><h2 id="route-and-router"><a href="#route-and-router" class="anchor"></a>Route and Router</h2><div class="odoc-spec"><div class="spec value" id="val-route" class="anchored"><a href="#val-route" class="anchor"></a><code><span><span class="keyword">val</span> route : <span>?method':<a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-request_target">request_target</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-route">route</a></span></span></code></div><div class="spec-doc"><p><code>route ~method' request_target handler</code> is a <a href="#type-route"><code>route</code></a>. The default value for <code>?method</code> is <code>`GET</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-routes" class="anchored"><a href="#val-routes" class="anchor"></a><code><span><span class="keyword">val</span> routes : <span><span><a href="#type-method'">method'</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-request_target">request_target</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-route">route</a></span> list</span></span></code></div><div class="spec-doc"><p><code>routes methods request_target handler</code> is a list of routes in which all have the same <code>request_target</code> and route <code>handler</code> value but each have one <code>method'</code> from <code>methods</code>. This is equivalent to calling <a href="#val-route"><code>route</code></a> like so:</p><pre><code>List.map (fun m -&gt; route ~method:m request_target handler) [meth1; meth2; meth3]</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-router" class="anchored"><a href="#val-router" class="anchor"></a><code><span><span class="keyword">val</span> router : <span><span><span><span class="type-var">'a</span> <a href="#type-route">route</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-router">router</a></span></span></code></div><div class="spec-doc"><p><code>router routes</code> is a <a href="#type-router"><code>router</code></a> made up of given <code>routes</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-router'" class="anchored"><a href="#val-router'" class="anchor"></a><code><span><span class="keyword">val</span> router' : <span><span><span><span><span class="type-var">'a</span> <a href="#type-route">route</a></span> list</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-router">router</a></span></span></code></div><div class="spec-doc"><p><code>router' routes_list = router (List.concat routes_list)</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-match'" class="anchored"><a href="#val-match'" class="anchor"></a><code><span><span class="keyword">val</span> match' : <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-router">router</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p><code>match' method' request_target router</code> is <code>Some a</code> if <code>method'</code> and <code>request_target</code> together matches one of the routes defined in <code>router</code>. Otherwise it is None.</p></div></div><h2 id="pp"><a href="#pp" class="anchor"></a>Pretty Printers</h2><div class="odoc-spec"><div class="spec value" id="val-pp_request_target" class="anchored"><a href="#val-pp_request_target" class="anchor"></a><code><span><span class="keyword">val</span> pp_request_target : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-request_target">request_target</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_method" class="anchored"><a href="#val-pp_method" class="anchor"></a><code><span><span class="keyword">val</span> pp_method : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-method'">method'</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp_route" class="anchored"><a href="#val-pp_route" class="anchor"></a><code><span><span class="keyword">val</span> pp_route : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-route">route</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-router">router</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>